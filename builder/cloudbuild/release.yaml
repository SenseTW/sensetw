steps:
- name: gcr.io/cloud-builders/gsutil
  entrypoint: 'bash'
  args:
  - '-c'
  - |
    gsutil cp -r gs://sensetw/$COMMIT_SHA/* /workspace/gcs-build/ || exit 0
- name: gcr.io/cloud-builders/docker
  args: ['run', '-v', '/workspace/sensemap:/workspace', 'gcr.io/$PROJECT_ID/sense-builder', "release", '$COMMIT_SHA']
- name: gcr.io/cloud-builders/gsutil
  args: ['-h', 'Cache-Control:private', 'cp', '-r','-a', 'public-read', '/workspace/sensemap/gcs-build/*', 'gs://sensetw/$COMMIT_SHA/']
- name: gcr.io/cloud-builders/gsutil
  args: ['setmeta', '-h', 'Cache-Control:no-cache, no-store, max-age=0', 'gs://sensetw/$COMMIT_SHA/service-worker.js']
- name: gcr.io/cloud-builders/gsutil
  args: ['-h', 'Cache-Control:private', 'cp', '-r', '-a', 'public-read', '/workspace/sensemap/gcs-build/*', 'gs://sensetw/']
- name: gcr.io/cloud-builders/gsutil
  args: ['setmeta', '-h', 'Cache-Control:no-cache, no-store, max-age=0', 'gs://sensetw/service-worker.js']
